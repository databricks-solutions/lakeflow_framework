resources:
  jobs:
    lakeflow_samples_day_2_load:
      name: Lakeflow Framework - Run 2 - Load (${var.logical_env})
      tasks:
        - task_key: staging_load
          notebook_task:
            notebook_path: ${workspace.file_path}/src/run_2_staging_load
            base_parameters:
              catalog: ${var.catalog}
              logical_env: ${var.logical_env}

        # Bronze pipelines
        - task_key: bronze_base_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_bronze_base_pipeline_id}
            full_refresh: false
          depends_on: 
            - task_key: staging_load
        - task_key: feature_samples_pipeline_general
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_feature_samples_pipeline_general_id}
            full_refresh: false
          depends_on: 
            - task_key: staging_load
        - task_key: feature_samples_pipeline_data_quality
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_feature_samples_pipeline_data_quality_id}
            full_refresh: false
          depends_on: 
            - task_key: staging_load
        - task_key: feature_samples_pipeline_snapshots
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_feature_samples_pipeline_snapshots_id}
            full_refresh: false
          depends_on: 
            - task_key: staging_load
        - task_key: feature_samples_pipeline_table_migration
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_feature_samples_pipeline_table_migration_id}
            full_refresh: false
          depends_on: 
            - task_key: staging_load  
        - task_key: yaml_sample_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_yaml_sample_pipeline_id}
            full_refresh: false
          depends_on:
            - task_key: staging_load
        - task_key: bronze_template_samples_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_bronze_template_samples_pipeline_id}
            full_refresh: false
          depends_on:
            - task_key: staging_load

        # Silver pipelines
        - task_key: silver_base_samples_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_base_samples_pipeline_id}
            full_refresh: false
          depends_on:
              - task_key: bronze_base_pipeline
        - task_key: silver_multi_source_streaming_basic_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_multi_source_streaming_basic_pipeline_id}
            full_refresh: false
          depends_on:
              - task_key: bronze_base_pipeline
        - task_key: silver_multi_source_streaming_decomp_final_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_multi_source_streaming_decomp_final_pipeline_id}
            full_refresh: false
          depends_on:
              - task_key: silver_multi_source_streaming_decomp_staging_pipeline
        - task_key: silver_multi_source_streaming_decomp_staging_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_multi_source_streaming_decomp_staging_pipeline_id}
            full_refresh: false
          depends_on:
              - task_key: bronze_base_pipeline
        - task_key: silver_base_samples_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_base_samples_pipeline_id}
            full_refresh: false
          depends_on:
              - task_key: bronze_base_pipeline
        - task_key: silver_stream_static_streaming_dwh_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_stream_static_streaming_dwh_pipeline_id}
            full_refresh: false
          depends_on:
              - task_key: bronze_base_pipeline

        # Gold pipelines
        - task_key: gold_stream_static_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_gold_stream_static_pipeline_id}
            full_refresh: false 
          depends_on:
            - task_key: silver_base_samples_pipeline

        # Validation
        - task_key: validate_run_2
          notebook_task:
            notebook_path: ${workspace.file_path}/src/validate_run_2
            base_parameters:
              catalog: ${var.catalog}
              logical_env: ${var.logical_env}
          depends_on:
            - task_key: bronze_base_pipeline
            - task_key: feature_samples_pipeline_general
            - task_key: feature_samples_pipeline_data_quality
            - task_key: feature_samples_pipeline_snapshots
            - task_key: yaml_sample_pipeline
            - task_key: silver_base_samples_pipeline
            - task_key: silver_multi_source_streaming_basic_pipeline
            - task_key: silver_multi_source_streaming_decomp_final_pipeline
            - task_key: gold_stream_static_pipeline

      queue:
        enabled: true