resources:
  jobs:
    lakeflow_samples_day_1_load_and_schema_initialization:
      name: Lakeflow Framework - Run 1 - Load and Schema Initialization (${var.logical_env})
      job_clusters:
        - job_cluster_key: ${var.job_cluster_name}
          new_cluster: ${var.job_cluster_config}
      tasks:
        - task_key: create_schemas_and_tables
          job_cluster_key: ${var.job_cluster_name}
          notebook_task:
            notebook_path: ${workspace.file_path}/src/create_schemas_and_tables
            base_parameters:
              catalog: ${var.catalog}
              schema_namespace: ${var.schema_namespace}
              logical_env: ${var.logical_env}
        - task_key: staging_load
          job_cluster_key: ${var.job_cluster_name}
          notebook_task:
            notebook_path: ${workspace.file_path}/src/run_1_staging_load
            base_parameters:
              catalog: ${var.catalog}
              schema_namespace: ${var.schema_namespace}
              logical_env: ${var.logical_env}
          depends_on:
            - task_key: create_schemas_and_tables

        # Bronze pipelines
        - task_key: bronze_base_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_bronze_base_pipeline_id}
            full_refresh: true
          depends_on: 
            - task_key: staging_load
        - task_key: feature_samples_pipeline_general
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_feature_samples_pipeline_general_id}
            full_refresh: true
          depends_on: 
            - task_key: staging_load
        - task_key: feature_samples_pipeline_data_quality
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_feature_samples_pipeline_data_quality_id}
            full_refresh: true
          depends_on: 
            - task_key: staging_load
        - task_key: feature_samples_pipeline_snapshots
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_feature_samples_pipeline_snapshots_id}
            full_refresh: true
          depends_on: 
            - task_key: staging_load
        - task_key: feature_samples_pipeline_table_migration
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_feature_samples_pipeline_table_migration_id}
            full_refresh: true
          depends_on: 
            - task_key: staging_load
        - task_key: yaml_sample_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_yaml_sample_pipeline_id}
            full_refresh: true
          depends_on:
            - task_key: staging_load

        # Silver pipelines
        - task_key: silver_base_samples_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_base_samples_pipeline_id}
            full_refresh: true
          depends_on:
              - task_key: bronze_base_pipeline
        - task_key: silver_multi_source_streaming_basic_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_multi_source_streaming_basic_pipeline_id}
            full_refresh: true
          depends_on:
              - task_key: bronze_base_pipeline
        - task_key: silver_multi_source_streaming_decomp_final_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_multi_source_streaming_decomp_final_pipeline_id}
            full_refresh: true
          depends_on:
              - task_key: silver_multi_source_streaming_decomp_staging_pipeline
        - task_key: silver_multi_source_streaming_decomp_staging_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_multi_source_streaming_decomp_staging_pipeline_id}
            full_refresh: true
          depends_on:
              - task_key: bronze_base_pipeline
        - task_key: silver_base_samples_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_base_samples_pipeline_id}
            full_refresh: true
          depends_on:
              - task_key: bronze_base_pipeline
        - task_key: silver_stream_static_streaming_dwh_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_stream_static_streaming_dwh_pipeline_id}
            full_refresh: true
          depends_on:
              - task_key: bronze_base_pipeline
        - task_key: silver_customer_dpm_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_silver_customer_dpm_pipeline_id}
            full_refresh: true
          depends_on:
              - task_key: bronze_base_pipeline

        # Gold pipelines
        - task_key: gold_stream_static_pipeline
          pipeline_task:
            pipeline_id: ${var.lakeflow_samples_gold_stream_static_pipeline_id}
            full_refresh: true 
          depends_on:
            - task_key: silver_base_samples_pipeline

        # Validation
        - task_key: validate_run_1
          job_cluster_key: ${var.job_cluster_name}
          notebook_task:
            notebook_path: ${workspace.file_path}/src/validate_run_1
            base_parameters:
              catalog: ${var.catalog}
              schema_namespace: ${var.schema_namespace}
              logical_env: ${var.logical_env}
          depends_on:
            - task_key: bronze_base_pipeline
            - task_key: feature_samples_pipeline_general
            - task_key: feature_samples_pipeline_data_quality
            - task_key: feature_samples_pipeline_snapshots
            - task_key: yaml_sample_pipeline
            - task_key: silver_base_samples_pipeline
            - task_key: silver_multi_source_streaming_basic_pipeline
            - task_key: silver_multi_source_streaming_decomp_final_pipeline
            - task_key: gold_stream_static_pipeline

      queue:
        enabled: true
  